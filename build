#! /usr/bin/env bash
# this was a copy-paste job from the output of the makefile

# first change directory to driver.
if [ "$1" == "-h" ]
    then
    echo "Bash script for building the firmaware\nusage: ./build \$main_directory \$main_file\nmain_directory is either 'demo' or 'missiom' depending on the file"
else
    cd src/driver
    REL_MAINDIR=".."
    MAINDIR="$1"
    MAINFILE="$2"
    OUTDIR="../../builds"
    strlen=${#MAINFILE}
    OUTFILE="build_${MAINFILE:0:$strlen-2}"
    WARNINGS="-Wall -Wextra -Wpedantic -Wswitch-default -Wswitch-enum -Wduplicated-cond -Wconversion -Wlogical-op -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations"

    arm-none-eabi-gcc \
    -mthumb -mcpu=cortex-m4 -mfpu=fpv4-sp-d16 -mfloat-abi=hard -ffunction-sections -fdata-sections -MD -std=c99 -c \
    -DPART_TM4C123GH6PGE \
    -DHEAPSIZE=0x2000 -DSTACKSIZE=0x800\
    -DTARGET_IS_TM4C123_RB1\
    -ITivaWare_C_Series-2.1.4.178\
    -ggdb3 -O0 \
    $WARNINGS \
    -mthumb -mcpu=cortex-m4 -mfpu=fpv4-sp-d16 -mfloat-abi=hard -Wl,--gc-sections -Wl,--print-memory-usage -nostartfiles --specs=nano.specs --specs=nosys.specs -Wl,--defsym,HEAPSIZE=0x2000 -Wl,--defsym,STACKSIZE=0x800  \
    $REL_MAINDIR/$MAINDIR/$MAINFILE  -o $OUTDIR/$OUTFILE
fi